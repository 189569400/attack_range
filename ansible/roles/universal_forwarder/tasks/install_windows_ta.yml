- name: Check we have downloaded splunk windows ta
  win_stat:
    path: C:\windows_ta.tgz
  register: windows_ta

- name: Download windows ta
  win_get_url:
    url: "{{ splunk_windows_ta }}" 
    dest: C:\windows_ta.tgz
    owner: splunk
    group: splunk
  notify: restart splunk
  when: windows_ta.stat.exists == False

- name: untar windows TA
  win_unzip:
    src: C:\windows_ta.tgz
    dest: C:\Program Files\SplunkUniversalForwarder\etc\apps\

- name: Install windows TA
  win_unzip:
    src: C:\Program Files\SplunkUniversalForwarder\etc\apps\windows_ta.tar
    dest: C:\Program Files\SplunkUniversalForwarder\etc\apps\
    delete_archive: yes
  notify: restart machine
